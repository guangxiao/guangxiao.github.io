---
layout: post
title: 简单理解 JavaScript 作用域
date: 2019-02-24 11:31:20
tags: JavaScript
categories: JavaScript
---

用一个简单粗俗的例子来理解 JavaScript 的作用域

### 角色
- 引擎：从头到尾负责整个 JavaScript 程序的编译及执行过程
- 编译器：引擎的好朋友之一，负责语法分析及代码生成等脏活累活
- 作用域：引擎的另外一位好朋友，负责收集并维护有所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限

### 例子

以 `var a = 2` 为例，分解步骤为

- 编译器首先会将这段程序分解成`词法单元`，然后将词法单元解析成一个树结构。
- 代码生成分为两步
    - 首先，编译器遇到了 `var a`，编译器会询问作用域是否已经有一个该名称的变量存在于同一个作用域的集合中。如果是，编译器会忽略该声明，继续进行编译；否则它会要求作用域在当前作用域的集合中声明一个新的变量，并命名为 `a`
    - 接下来，编译器会为引擎开始生成运行时需要的代码，这些代码被用来处理 `a = 2` 这个赋值操作，引擎运行时会首先询问作用域，在当前的作用域集合中是否存在一个叫做 `a` 的变量，如果是，引擎使用这个变量；如果否，引擎继续查找该变量，如果最终找到了 `a` 变量，就会将 2 赋值给它。否则引擎随手啪给你扔一个异常

总之就是，变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量（如果之前没有声明过），然后在运行时引擎会在作用域中查找该变量，如果能找到就对它赋值。







